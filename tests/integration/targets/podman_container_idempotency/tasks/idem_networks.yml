- name: Remove container netcontainer
  containers.podman.podman_container:
    executable: "{{ test_executable | default('podman') }}"
    name: netcontainer
    state: absent
    podman_socket: "{{ podman_socket | default(omit) }}"

- name: Run container with {{ item.first_net }}
  containers.podman.podman_container:
    executable: "{{ test_executable | default('podman') }}"
    name: netcontainer
    image: "{{ idem_image }}"
    command: 1h
    state: started
    network: "{{ item.first_net }}"
    podman_socket: "{{ podman_socket | default(omit) }}"

- name: Run container again with {{ item.first_net }}
  containers.podman.podman_container:
    executable: "{{ test_executable | default('podman') }}"
    name: netcontainer
    image: "{{ idem_image }}"
    command: 1h
    state: present
    network: "{{ item.first_net }}"
    podman_socket: "{{ podman_socket | default(omit) }}"
  register: info

- name: Check info for 2 runs of {{ item.first_net }}
  assert:
    that:
      - info is not changed

- name: Run changed container with {{ item.next_net }}
  containers.podman.podman_container:
    executable: "{{ test_executable | default('podman') }}"
    name: netcontainer
    image: "{{ idem_image }}"
    command: 1h
    state: present
    network: "{{ item.next_net }}"
    podman_socket: "{{ podman_socket | default(omit) }}"
  register: info1

- name: Check info
  assert:
    that:
      - info1 is changed
